<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>    <title>myOperation</title>    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" charset="utf-8">    <link rel="stylesheet" type="text/css" href="stylesheets/screen.css" media="screen, projection" charset="utf-8">        <meta name="viewport" content="initial-scale=1.0, user-scalable=no">            <meta charset="utf-8">                <style>                    html, body, #map-canvas {                        margin: 0;                        padding: 0;                        height: 100%;                    }                    </style>                <style type="text/css">                    .labels {                        color: red;                        background-color: white;                        font-family: "Lucida Grande", "Arial", sans-serif;                        font-size: 10px;                        font-weight: bold;                        text-align: center;                        width: 40px;                        border: 2px solid black;                        white-space: nowrap;                    }                    </style>              <style type="text/css">                .labels {                  color: red;                  background-color: white;                  font-family: "Lucida Grande", "Arial", sans-serif;                  font-size: 10px;                  font-weight: bold;                  text-align: center;                  width: 40px;                  border: 2px solid black;                  white-space: nowrap;                }                </style>                            <style TYPE="text/css">                <!--                html, body {                  height: 100%;                  margin: 0;                  padding: 0;                }                                #map-canvas, #map_canvas {                  height: 100%;                }                                @media print {                  html, body {                    height: auto;                  }                                    #map-canvas, #map_canvas {                    height: 650px;                  }                }                                #panel {                  position: absolute;                  top: 5px;                  left: 50%;                  margin-left: -180px;                  z-index: 5;                  background-color: #fff;                  padding: 5px;                  border: 1px solid #999;                }                -->            </style>              <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>              <script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script>                                        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>                    <script type="text/javascript" src="stylesheets/markerwithlabel.js"></script>                    <script type="text/javascript">                        var _gaq = _gaq || [];                        _gaq.push(['_setAccount', 'UA-33034181-1']);                        _gaq.push(['_trackPageview']);                         (function() {                         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;                         ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';                         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);                         })();                        </script>                                                <script>                    var all = [                               ["94305","$425K", "Stanford Hospital"],                               ["95101","$100K", "Kaiser Hospital"]                               ];                  var shape = {                    coord: [1, 1, 1, 20, 18, 20, 18 , 1],                    type: 'poly'                  };                    var map;                    var index=0;                    google.maps.visualRefresh = true                                      function getHospitalInfo() {                                            var xmlHttp = null;                      myZip = window.document.getElementById('searchBox2')                                            urlString = "https://data.cms.gov/resource/inpatient-charge-data-FY2011.json?provider_zip_code=".concat(myZip.value)                      xmlHttp = new XMLHttpRequest();                      xmlHttp.open( "GET", urlString, false );                      xmlHttp.setRequestHeader("X-App-Token","QsPJzBHtT7FAtkgEOmbi8vry8")                      xmlHttp.send( null );                      return xmlHttp.responseText;                    }                                   function Label(opt_options) {                    // Initialization                    this.setValues(opt_options);                    // Here go the label styles                    var span = this.span_ = document.createElement('span');                    span.style.cssText = 'position: relative; left: -50%; top: -10px; ' +                    'white-space: nowrap;color:#ffffff;' +                    'padding: 2px;font-family: Arial; font-weight: bold;' +                    'font-size: 16px;' +                     'color:black';                                        var div = this.div_ = document.createElement('div');                    div.appendChild(span);                    div.style.cssText = 'position: absolute; display: none';                  };                  Label.prototype = new google.maps.OverlayView;                                    Label.prototype.onAdd = function() {                    var pane = this.getPanes().overlayImage;                    pane.appendChild(this.div_);                                        // Ensures the label is redrawn if the text or position is changed.                    var me = this;                    this.listeners_ = [                                       google.maps.event.addListener(this, 'position_changed',                                                                     function() { me.draw(); }),                                       google.maps.event.addListener(this, 'text_changed',                                                                     function() { me.draw(); }),                                       google.maps.event.addListener(this, 'zindex_changed',                                                                     function() { me.draw(); })                                       ];                  };                                    // Implement onRemove                  Label.prototype.onRemove = function() {                    this.div_.parentNode.removeChild(this.div_);                                        // Label is removed from the map, stop updating its position/text.                    for (var i = 0, I = this.listeners_.length; i < I; ++i) {                      google.maps.event.removeListener(this.listeners_[i]);                    }                  };                                    // Implement draw                  Label.prototype.draw = function() {                    var projection = this.getProjection();                    var position = projection.fromLatLngToDivPixel(this.get('position'));                    var div = this.div_;                    div.style.left = position.x + 'px';                    div.style.top = position.y + 'px';                    div.style.display = 'block';                    div.style.zIndex = this.get('zIndex'); //ALLOW LABEL TO OVERLAY MARKER                    this.span_.innerHTML = this.get('text').toString();                  };                                    var markersArray = [];                                    function clearOverlays() {                    for (var i = 0; i < markersArray.length; i++ ) {                      markersArray[i].setMap(null);                    }                    markersArray = [];                  }                                      function getMapInfo() {                                                             resp = getHospitalInfo()                        all = JSON.parse(resp)                        var geocoder = new google.maps.Geocoder();                        var myLatlng = new google.maps.LatLng(37.32, -122.04);                                                var mapOptions = {                            zoom: 10,                            mapTypeId: google.maps.MapTypeId.ROADMAP                        };                                                myOp = window.document.getElementById('searchBox1')                        myOpString = myOp.value                        for(var i=1; i<=all.length; i++) {                            var zip	= all[i]["provider_zip_code"];                                                    Operation = all[i]["drg_definition"].toLowerCase()                          if(myOpString!="" && Operation.search(myOpString) != -1) {                          }                           else{                            continue                          }                                                    //clear overlay markers                          clearOverlays();                          //alert(theop);                            geocoder.geocode( { 'address': zip}, function(results, status) {                                             if (status == google.maps.GeocoderStatus.OK) {                                             //Got result, center the map and put it out there                                             map.setCenter(results[0].geometry.location);                                                                                          value = Math.round(all[index]["average_covered_charges"]/1000)                                             mystring = "$".concat(value).concat("K")                                                                                          var hospitalImage = {                                             url: 'images/hospital.png',                                             // This marker is 20 pixels wide by 32 pixels tall.                                             size: new google.maps.Size(20, 32),                                             // The origin for this image is 0,0.                                             origin: new google.maps.Point(0,0),                                                                                          anchor: new google.maps.Point(0, 32)                                             };                                                                                          var marker = new google.maps.Marker({                                                                                 position: results[0].geometry.location,                                                                                 map: map,                                                                                 shape: shape,                                                                                 title: "Hello World!",                                                                                 zIndex: 1234,                                                                                 icon: hospitalImage                                                                                 });                                             markersArray.push(marker);                                             var label = new Label({                                                                   map: map                                                                   });                                             label.set('zIndex', 1234);                                             label.bindTo('position', marker, 'position');                                             label.set('text', mystring);                                                                                                                                    var contentString = all[index]["provider_name"];                                             var infowindow = new google.maps.InfoWindow({                                               content: contentString                                             });                                                                                          google.maps.event.addListener(marker, 'click', function() {                                               infowindow.open(map,marker);                                             });                                                                                          index = index+1;                                             } else {                                             alert("Geocode was not successful for the following reason: " + status);                                             }                                            });                        }                                                var iw1 = new google.maps.InfoWindow({                                                             content: all[i][2]                                                             });                        google.maps.event.addListener(marker, "click", function (e) { iw1.open(map, this); });                    }                                                        function initialize() {                                                                                var geocoder = new google.maps.Geocoder();                    var myLatlng = new google.maps.LatLng(37.32, -122.04);                                        var mapOptions = {                      zoom: 10,                      center: myLatlng,                      mapTypeId: google.maps.MapTypeId.ROADMAP                    };                                        map = new google.maps.Map(window.document.getElementById('mapcanvas'),                                              mapOptions);                                                                            var iw1 = new google.maps.InfoWindow({                                                         content: all[i][2]                                                         });                    google.maps.event.addListener(marker, "click", function (e) { iw1.open(map, this); });                  }                                    function isEnterKey(e) {                    if (e.keyCode == 13) {                      getMapInfo();                      return true;                    }                  }                                        google.maps.event.addDomListener(window, 'load', initialize);                    google.maps.event.addListener(marker,"click",function(){});                    document.getElementById("searchBox1").addEventListener("keydown", function(e) {                                                                                                                                                                  // Enter is pressed                                                                                 if (e.keyCode == 13) { getMapInfo(); }                                                                                 }, false);                    </script></head>    <body>        <div id="mapcanvas">    </div>        <div><input id="searchBox1" onkeypress="return isEnterKey(event)" type="text" name="q"  class="ui-autocomplete-input" autocomplete="off" role="textbox" aria-autocomplete="list" aria-haspopup="true" placeholder="Try 'nervous system disorder'"></div>        <div><input id="searchBox2" onkeypress="return isEnterKey(event)" type="text" class="location ui-autocomplete-input" autocomplete="off" role="textbox" aria-autocomplete="list" aria-haspopup="true" placeholder="Try '94305'"></div>                                    </body></html>