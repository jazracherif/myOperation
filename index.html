<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>    <title>myOperation</title>    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" charset="utf-8">    <link rel="stylesheet" type="text/css" href="stylesheets/screen.css" media="screen, projection" charset="utf-8">        <meta name="viewport" content="initial-scale=1.0, user-scalable=no">            <meta charset="utf-8">                <style>                    html, body, #map-canvas {                        margin: 0;                        padding: 0;                        height: 100%;                    }                    </style>                <style type="text/css">                    .labels {                        color: red;                        background-color: white;                        font-family: "Lucida Grande", "Arial", sans-serif;                        font-size: 10px;                        font-weight: bold;                        text-align: center;                        width: 40px;                        border: 2px solid black;                        white-space: nowrap;                    }                    </style>              <style type="text/css">                .labels {                  color: red;                  background-color: white;                  font-family: "Lucida Grande", "Arial", sans-serif;                  font-size: 10px;                  font-weight: bold;                  text-align: center;                  width: 40px;                  border: 2px solid black;                  white-space: nowrap;                }                </style>                            <style TYPE="text/css">                <!--                html, body {                  height: 100%;                  margin: 0;                  padding: 0;                }                                #map-canvas, #map_canvas {                  height: 100%;                }                                @media print {                  html, body {                    height: auto;                  }                                    #map-canvas, #map_canvas {                    height: 650px;                  }                }                                #panel {                  position: absolute;                  top: 5px;                  left: 50%;                  margin-left: -180px;                  z-index: 5;                  background-color: #fff;                  padding: 5px;                  border: 1px solid #999;                }                -->            </style>              <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>              <script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script>                                        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>                    <script type="text/javascript" src="stylesheets/markerwithlabel.js"></script>                    <script type="text/javascript">                        var _gaq = _gaq || [];                        _gaq.push(['_setAccount', 'UA-33034181-1']);                        _gaq.push(['_trackPageview']);                         (function() {                         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;                         ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';                         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);                         })();                        </script>                                                <script>                  var shape = {                    coord: [1, 1, 1, 20, 18, 20, 18 , 1],                    type: 'poly'                  };                    var map;                    var index=0;                    google.maps.visualRefresh = true                  var dataRecordList = {}                                                      function Label(opt_options) {                    // Initialization                    this.setValues(opt_options);                    // Here go the label styles                    var span = this.span_ = document.createElement('span');                    span.style.cssText = 'position: relative; left: -50%; top: -10px; ' +                    'white-space: nowrap;color:#ffffff;' +                    'padding: 2px;font-family: Arial; font-weight: bold;' +                    'font-size: 16px;' +                     'color:black';                                        var div = this.div_ = document.createElement('div');                    div.appendChild(span);                    div.style.cssText = 'position: absolute; display: none';                  };                                    Label.prototype = new google.maps.OverlayView;                                    Label.prototype.onAdd = function() {                    var pane = this.getPanes().overlayImage;                    pane.appendChild(this.div_);                                        // Ensures the label is redrawn if the text or position is changed.                    var me = this;                    this.listeners_ = [                                       google.maps.event.addListener(this, 'position_changed',                                                                     function() { me.draw(); }),                                       google.maps.event.addListener(this, 'text_changed',                                                                     function() { me.draw(); }),                                       google.maps.event.addListener(this, 'zindex_changed',                                                                     function() { me.draw(); })                                       ];                  };                                    // Implement onRemove                  Label.prototype.onRemove = function() {                    this.div_.parentNode.removeChild(this.div_);                                        // Label is removed from the map, stop updating its position/text.                    for (var i = 0, I = this.listeners_.length; i < I; ++i) {                      google.maps.event.removeListener(this.listeners_[i]);                    }                  };                                    // Implement draw                  Label.prototype.draw = function() {                    var projection = this.getProjection();                    var position = projection.fromLatLngToDivPixel(this.get('position'));                    var div = this.div_;                    div.style.left = position.x + 'px';                    div.style.top = position.y + 'px';                    div.style.display = 'block';                    div.style.zIndex = this.get('zIndex'); //ALLOW LABEL TO OVERLAY MARKER                    this.span_.innerHTML = this.get('text').toString();                  };                                    var markersArray = [];                                    function clearOverlays() {                    for (var i = 0; i < markersArray.length; i++ ) {                      markersArray[i].setMap(null);                    }                    markersArray = [];                  }                                    function addDataRecord(zipcode, record){                    dataRecordList[zipcode] = record                    console.log("adding", zipcode, record)                  }                                    function getDataRecord(zipcode){                    return dataRecordList[zipcode]                  }                                    function getDataRecordbyAddress(address){                                        for (item in dataRecordList) {                      if(address.search(dataRecordList[item]["provider_street_address"]) != -1)                         console.log("item",dataRecordList[item]);                        return dataRecordList[item];                    }                    return null                                  }                                    function clearDataRecord(){                    dataRecordList = {}                  }                                    function printDataRecord(){                    console.log(dataRecordList)                  }                                    function geocoderPointResult (results, status) {                                        if (status == google.maps.GeocoderStatus.OK) {                      //Got result, center the map and put it out there                      map.setCenter(results[0].geometry.location);                                            console.log("geocoderResult", results)                                                                  myAddressObjectLength = results[0]["address_components"]["length"]-1                      myZip =results[0]["address_components"][myAddressObjectLength.toString()]["short_name"]                                                        data = getDataRecord(myZip)                      if(data == null){                        data = getDataRecordbyAddress(results[0]["formatted_address"])                      }                      console.log("draw results",myZip, data)                                            value = Math.round(data["average_covered_charges"]/1000)                      mystring = "$".concat(value).concat("K")                                            var image = {                                                url: "images/iconhospital.png"                                              };                                                                  var hospitalMarker = new google.maps.Marker({                                                                  position: results[0].geometry.location,                                                                  map: map,                                                                  animation: google.maps.Animation.DROP,                                                                                                                                      title: 'Click to zoom',                                                                  zIndex: 1234,                                                                  icon: image                                                                  });                                                                  markersArray.push(hospitalMarker);                                            var label = new Label({                                            map: map                                            });                                            label.set('zIndex', 1234);                      label.bindTo('position', hospitalMarker, 'position');                      label.set('text', mystring);                                            markersArray.push(label);                                                                  //var contentString = allResultRecords[index]["provider_name"];                      var contentString =data["provider_name"]+"\t"+data["drg_definition"]                                            //var infowindow = new google.maps.InfoWindow({                                                                  //content: contentString                                                                  //});                        google.maps.event.addListener(hospitalMarker, 'click', function () {                                                      $("#contentString").show();                                                      document.getElementById("contentString").innerHTML = contentString;                                                      });                                              //google.maps.event.addListener(hospitalMarker, 'click', function() {                                                    //infowindow.open(map,hospitalMarker);                                                   // });                      map.setZoom(12);                      map.setCenter(marker.getPosition());                                            index = 0;                    }                     else {                      console.log("Geocode was not successful for the following reason: ", status);                    }                  }                                                                                        function showNoResults(){                      //Show error message                      $("#ErrorMsg").show()                      $(function() {                        // setTimeout() function will be fired after page is loaded                        // it will wait for 5 sec. and then will fire                        setTimeout(function() {                                   $("#ErrorMsg").hide()                                   }, 3000);                        });                                            return                                        }                                                         function hospitalInfoCanvas(){                    //Show Canvas on Marker Click                    $("#contentString").show()                    var contentString =data["provider_name"]+"\t"+data["drg_definition"]                    console.log("here is the content ", contentString);                                            }                                      function getMapInfo(data, status, xhr) {                                           if(status!="success"){                        return;                      }                                              //clear data from record                                              //Get result info                                            allResultRecords = data                                                                    var geocoder = new google.maps.Geocoder();                        var myLatlng = new google.maps.LatLng(37.32, -122.04);                                                var mapOptions = {                            zoom: 10,                            mapTypeId: google.maps.MapTypeId.ROADMAP                        };                                                                       myOp = window.document.getElementById('searchBox1')                        myOpString = myOp.value                                                                      for(var i=1; i< allResultRecords.length; i++) {                                                    //console.log(i,allResultRecords[i])                                                    var zip	= allResultRecords[i]["provider_zip_code"];                          //console.log(allResultRecords[i]["provider_zip_code"])                                                    //Chech if the user string matches any word in the description                          Operation = allResultRecords[i]["drg_definition"].toLowerCase()                          if(myOpString!="" && Operation.search(myOpString) != -1) {                                                      }                           else{                            continue                          }                                                    //clear overlay markers                          addDataRecord(zip, allResultRecords[i])                                                    //alert(theop);                          address= allResultRecords[i]["provider_street_address"]+" "+allResultRecords[i]["provider_state"]+" "+allResultRecords[i]["provider_zip_code"]                          geocoder.geocode( { 'address': address},  geocoderPointResult )                                                  var iw1 = new google.maps.InfoWindow({                                                             content: allResultRecords[i][2]                                                             });                          google.maps.event.addListener(hospitalMarker, "click", function (e) { iw1.open(map, this); });                        }                    }                                    function findHospitalRecord(list, definitionToMatch){                                      }                                    function getHospitalInfo(myZip) {                                        var xmlHttp = null;                                        urlString = "https://data.cms.gov/resource/inpatient-charge-data-FY2011.json?provider_zip_code="+myZip                    console.log(urlString)                    $.ajax({                           url: urlString,                           success: getMapInfo,                           dataType: 'json'                           });                  }                                    function getNearbyZipCodesResults(data, status, xhr){                    //We got a list of zipcodes                    jQuery.each(data["postalCodes"], function(index, value){                                zipcode = value["postalCode"];                                getHospitalInfo(String(zipcode))                                                                })                  }                                    function getNearbyZipCodes(myZip) {                                        radius = "30"                    userName = "myoperation"                    country = "us"                    var xmlHttp = null;                                                            //urlString = "https://data.cms.gov/resource/inpatient-charge-data-FY2011.json?provider_zip_code=".concat(myZip.value)                    urlString = "http://api.geonames.org/findNearbyPostalCodesJSON?postalcode="+myZip.value+"&country=US&radius="+radius+"&username="+userName+"&maxRows=100"                    console.log(urlString)                                        $.ajax({                           url: urlString,                           success: getNearbyZipCodesResults,                           dataType: 'json'                           });                  }                                    function getWikiInfoResults(data, status, xhr){                    console.log("wiki info", status,  data)                  }                                    function getWikiInfo(dataString){                                        $.ajaxSetup({                                beforeSend: function(request) {                                request.setRequestHeader("User-Agent","myoperation");                                }                                });                                        var xmlHttp = null;                                        //dataString = "Main%20Page"                    urlString = "http://en.wikipedia.org/w/api.php?format=xml&action=query&titles="+dataString+"&prop=revisions&rvprop=content"                    console.log(urlString)                                        $.ajax({                           url: urlString,                           success: getWikiInfoResults,                           dataType: 'xml'                           });                  }                                    function initialize() {                                                                              var geocoder = new google.maps.Geocoder();                    var myLatlng = new google.maps.LatLng(37.32, -122.04);                                        var mapOptions = {                      zoom: 10,                      center: myLatlng,                      mapTypeId: google.maps.MapTypeId.ROADMAP                    };                                        map = new google.maps.Map(window.document.getElementById('mapcanvas'),                                              mapOptions);                                                                          }                                    function isEnterKey(e) {                    if (e.keyCode == 13) {                      myZip = window.document.getElementById('searchBox2')                      clearOverlays();                      clearDataRecord()                      getNearbyZipCodes(myZip);                      return true;                    }                  }                                        google.maps.event.addDomListener(window, 'load', initialize);                    //google.maps.event.addListener(hospitalMarker,"click",function(){});                    document.getElementById("searchBox1").addEventListener("keydown", function(e) {                                                                                                                                                                  // Enter is pressed                                                                                 if (e.keyCode == 13) { getHospitalInfo(); }                                                                                 }, false);                    </script></head>    <body>      <body>        <div id="ErrorMsg" style="display: none;"> No Results Found</div>        <div id="contentString" style="display: none; color: white";>  </div>        <div id="mapcanvas">    </div>        <div><input id="searchBox1" onkeypress="return isEnterKey(event)" type="text" name="q"  class="ui-autocomplete-input" autocomplete="off" role="textbox" aria-autocomplete="list" aria-haspopup="true" placeholder="Try 'nervous system disorder'"></div>                <div><input id="searchBox2" onkeypress="return isEnterKey(event)" type="text" class="location ui-autocomplete-input" autocomplete="off" role="textbox" aria-autocomplete="list" aria-haspopup="true" placeholder="Try '94305'"></div>              </body></html>